---
  - name: Install Basic Packages
    hosts: localhost
    tasks:
      - name: Wget
        apt:
          name: wget
          state: latest
  - name: Downloading Scripts for Setting up OpenVPN and PiHole
    hosts: localhost
    tasks:
      - name: OpenVPN
        shell: wget https://git.io/vpn -O /root/openvpn-install.sh && chmod 755 /root/openvpn-install.sh
      - name: PiHole
        get_url:
          url: https://raw.githubusercontent.com/pi-hole/pi-hole/master/automated%20install/basic-install.sh 
          dest: /root/
      
#This NFS Share is used to acted as a bridge between my cloud and Local infrastructure
  - name: Configure NFS
    hosts: localhost
    vars_prompt:
      - name: NFS_Network
        prompt: What is the Network address for the NFS Share?
        private: no
    tasks:
      - name: Install NFS-Utils
        apt:
          name: nfs-kernel-server
          state: latest
# Create File Share          
      - name: Create File Sync Mount Point
        file:
          path: /media/FileSync
          state: directory
          mode: 0777
      - name: Create NFS Export Entry for Podcast Sync
        shell: echo "/media/FileSync {{NFS_Network}}(rw,sync,no_root_squash)" >> /etc/exports.d/cockpit-file-sharing.exports
      - name: Restart NFS Service
        systemd:
          name: nfs-server
          state: restarted
          daemon_reload: yes
          enabled: yes
## Configure Firewall (UFW)
#  - name: Configure UFW
#    hosts: localhost
#    tasks:
#      - name: Set Default Profiles
#        shell: ufw default deny incoming && ufw default allow outgoing
#      - name: Allow SSH
#        - ufw:
#            rule: limit
#            port: ssh
#            proto: tcp
#      - name: Allow NFS
#        - ufw:
#            rule: allow
#            port: nfs
#            proto: tcp
## Commented out for Local Testing will test in DO before Deployment
##            interface: eth1
#      - name: Enable UFW
#        shell: ufw enable
#
##These Services are responsible for the sync of files between the Cloud Server and the Local Server (OpenVPN&PiHole to Slave1)  
#  - name: Set up Systemd Timers and services
#    hosts: localhost
#    tasks:
#      - name: FileSync Service
#        copy:
#          src: /root/Playbooks/App Deployment/OpenVPN&PiHole/Systemd Timer/FileSync.service
#          dest: /etc/systemd/system
#      - name: Playlist_Sync Timer
#        copy:
#          src: /root/Playbooks/App Deployment/OpenVPN&PiHole/Systemd Timer/FileSync.timer
#          dest: /etc/systemd/system
